@{
    ViewBag.Title = "Entregar";
    Layout = "~/Views/Compartida/_layout.cshtml";
}

<div class="container">
    <div class="row">
        <div class="col-md-6">
            <h2 style="margin-top: 0px">Entregar</h2>
        </div>
        <div class="col-md-6">
            <a id="ExportarExcel" href="/Compras/ExportarEncargado" target="_blank" class="btn btn-primary" style="float: right;"><span class="fa fa-file-excel-o"></span>Generar Reporte</a>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <table id="tabla" class="table table-bordered bg_blanco table-hover"></table>
        </div>
    </div>
</div>

@section scripts{
    <script type="text/javascript">
        var columnas = [
               {
                   //estos son de bootstrap table
                   field: "idCompra",
                   visible: false,
               },
               {
                   field: "nombre",
                   align: 'center',
                   valign: 'middle',
                   title: "Vecino",
                   sortable: "true",
               },
               {
                   field: "productos",
                   align: 'left',
                   valign: 'middle',
                   title: "Productos",
                   sortable: "true",
               },
               {
                   field: "precio",
                   align: 'center',
                   valign: 'middle',
                   title: "Total",
               },
               {
                   field: 'retiro',
                   title: 'Retiró?',
                   valign: 'middle',
                   align: 'center',
                   width: '5%',
                   events: {
                       'click .Retiro': function (e, value, row, index) {

                           $(e.target).removeAttr("class").addClass("fa fa-circle-o-notch fa-spin fa-fw").closest("a").addClass("notactive");
                           $.post("/Compras/EnregarPedido", { idCompra: row.idCompra, entregado: true }, function (devuelta) {
                               $(e.target).removeAttr("class").addClass("fa fa-thumbs-o-up").closest("a").removeClass("notactive");
                           });
                       },
                       'click .Colgo': function (e, value, row, index) {

                           $(e.target).removeAttr("class").addClass("fa fa-circle-o-notch fa-spin fa-fw").closest("a").addClass("notactive");
                           $.post("/Compras/EnregarPedido", { idCompra: row.idCompra, entregado: false }, function (devuelta) {
                               $(e.target).removeAttr("class").addClass("fa fa-thumbs-o-down").closest("a").removeClass("notactive");
                           });
                       },
                   },
                   formatter: function operateFormatter(value, row, index) {
                       if (value != 3 && value != 5 )
                       {
                           return "<a style='cursor:pointer' class='Retiro' title='Retiro'>Si</a> - <a style='cursor:pointer' class='Colgo' title='Colgo'>No</a>";
                       }
                       else if (value == 3)
                           return '<i class="fa fa-thumbs-o-up" aria-hidden="true"></i>'
                       else
                           return '<i class="fa fa-thumbs-o-down" aria-hidden="true"></i>'

                   }
               }
        ];

        var tabla = $("#tabla");
        tabla.bootstrapTable({
            url: "/Compras/ListaTanda",
            method: "POST",
            columns: columnas
        });
    </script>
}